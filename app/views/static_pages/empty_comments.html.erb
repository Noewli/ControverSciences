<div id="my-container" class="container-fluid">
  <div class="row">
    <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3 col-lg-2 col-lg-offset-0">
      <div class="list-group">
        <%= link_to "<span class=\"icon-4 normal\"></span>
                                    Enrichir les controverses
                                    <span class=\"badge\">#{Timeline.where(nb_references: 0..3).count}</span>".html_safe,
                    empty_references_path,
                    class: "list-group-item" %>
        <% if logged_in? %>
            <%= link_to "<span class=\"glyphicon glyphicon-thumbs-up normal\"></span>
                        Enrichir les controverses qui m'intéressent
                        <span class=\"badge\">#{Timeline.where( id: @like_ids ).where(nb_references: 0..3).count}</span>".html_safe,
                        empty_references_path(filter: "interest"),
                        class: "list-group-item" %>
            <%= link_to "<span class=\"icon-user normal\"></span>
                                Enrichir mes controverses
                                <span class=\"badge\">#{Timeline.where(user_id: current_user.id).where(nb_references: 0..3).count}</span>".html_safe,
                        empty_references_path(filter: "mine"),
                        class: "list-group-item" %>
        <% end  %>
      </div>
      <div class="list-group">
        <%= link_to "<span class=\"icon-4 normal\"></span>
                                    Analyser les références
                                    <span class=\"badge\">#{Reference.where(title_fr: nil).count}</span>".html_safe,
                    empty_comments_path,
                    class: "list-group-item #{ ((!logged_in?)||(params[:filter].blank?)) ? "list-group-item-default cursor-not-allowed" : ""}" %>
        <% if logged_in? %>
            <%= link_to "<span class=\"glyphicon glyphicon-thumbs-up normal\"></span>
                        Analyser les références qui m'intéressent
                        <span class=\"badge\">#{Reference.where( timeline_id: @like_ids ).where(title_fr: nil).count}</span>".html_safe,
                        empty_comments_path(filter: "interest"),
                        class: "list-group-item #{ (params[:filter] == "interest") ? "list-group-item-default cursor-not-allowed" : ""}" %>
            <%= link_to "<span class=\"icon-user normal\"></span>
                                Analyser mes références
                                <span class=\"badge\">#{Reference.where(user_id: current_user.id).where(title_fr: nil).count}</span>".html_safe,
                        empty_comments_path(filter: "mine"),
                        class: "list-group-item #{ (params[:filter] == "mine") ? "list-group-item-default cursor-not-allowed" : ""}" %>
        <% end  %>
      </div>
      <div class="list-group">
        <%= link_to "<span class=\"icon-4 normal\"></span>
                                    Synthètiser les controverses
                                    <span class=\"badge\">#{Timeline.where(nb_summaries: 0).where.not(nb_references: 0..3).where.not(nb_comments: 0..3).count}</span>".html_safe,
                    empty_summaries_path,
                    class: "list-group-item" %>
        <% if logged_in? %>
            <%= link_to "<span class=\"glyphicon glyphicon-thumbs-up normal\"></span>
                        Synthètiser les controverses qui m'intéressent
                        <span class=\"badge\">#{Timeline.where( id: @like_ids ).where(nb_summaries: 0).where.not(nb_references: 0..3).where.not(nb_comments: 0..3).count}</span>".html_safe,
                        empty_summaries_path(filter: "interest"),
                        class: "list-group-item" %>
            <%= link_to "<span class=\"icon-user normal\"></span>
                                Synthètiser mes controverses
                                <span class=\"badge\">#{Timeline.where(user_id: current_user.id).where(nb_summaries: 0).where.not(nb_references: 0..3).where.not(nb_comments: 0..3).count}</span>".html_safe,
                        empty_summaries_path(filter: "mine"),
                        class: "list-group-item" %>
        <% end  %>
      </div>
    </div>
    <div class="col-xs-12 col-md-offset-2 col-md-8 col-lg-offset-1 col-lg-6">
      <br/>
      <br/>
      <% if @references.any? %>
          <div class="panel panel-default">
            <div class="panel-body">
              <h3>
                <span class="icon-4 pull-right" style="margin-right: 15px"></span>
                Ces références
                <% if logged_in? %>
                    <% if params[:filter] == "mine" %>
                        que vous avez ajoutées
                    <% else %>
                        qui vous intéressent
                    <% end %>
                <% end %>
                    n'ont pas encore d'analyse, soyez le premier à les décortiquer !
              </h3>
            </div>
          </div>
          <div id="cd-timeline" class="cd-container">
            <% @references.each do |reference| %>
                <div class="cd-timeline-block binary3">
                  <div class="cd-timeline-img gradient-orange">
                  </div>
                  <div class="cd-timeline-content">
                    <h2> <%= link_to reference.title, new_comment_path(reference_id: reference.id ), class: "hvr-grow1 orange" %>
                    </h2>
                    <h2>
                    dans la controverse
                    </h2>
                    <h2> <%= link_to reference.timeline_name.html_safe, timeline_path( reference.timeline_id ), class: "hvr-grow1" %>
                    </h2>
                    <span class="cd-date">Référence ajoutée il y a <%= time_ago_in_words(reference.created_at) %></span>
                  </div>
                </div>
            <% end %>
          </div>
      <% else %>
          <div class="panel panel-default">
            <div class="panel-body">
              <h3>
                <span class="icon-4 pull-right" style="margin-right: 15px"></span>
                Toutes les références
                <% if logged_in? %>
                    <% if params[:filter] == "mine" %>
                        que vous avez ajoutées
                    <% else %>
                        qui vous intéressent
                    <% end %>
                <% end %>
                ont actuellement au moins une analyse.
              </h3>
              <%= link_to "<span class=\"icon-frog fat\"></span> Voir les controverses".html_safe, timelines_path, class: "btn btn-primary btn-lg pull-right" %>
            </div>
          </div>
      <% end %>
    </div>
  </div>
</div>

<script type="text/javascript">
    $(document).ready(function(){
        $('[data-toggle="tooltip"]').tooltip({container: 'body'});
        var $timeline_block = $('.cd-timeline-block');

        //hide timeline blocks which are outside the viewport
        $timeline_block.each(function(){
            $(this).find('.cd-timeline-img, .cd-timeline-content').addClass('is-hidden');
        });

        $timeline_block.each(function(){
            if( $(this).offset().top <= $(window).scrollTop()+$(window).height()*0.95 ) {
                $(this).find('.cd-timeline-img, .cd-timeline-content').removeClass('is-hidden').addClass('bounce-in');
            }
        });

        //on scolling, show/animate timeline blocks when enter the viewport
        $(window).on('scroll', function(){
            $timeline_block.each(function(){
                if( $(this).offset().top <= $(window).scrollTop()+$(window).height()*0.95 && $(this).find('.cd-timeline-img').hasClass('is-hidden') ) {
                    $(this).find('.cd-timeline-img, .cd-timeline-content').removeClass('is-hidden').addClass('bounce-in');
                }
            });
        });
    });
</script>
