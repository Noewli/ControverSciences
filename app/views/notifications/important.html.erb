<% provide(:title, "Notifications") %>
<div id="my-container" class="container-fluid">
  <div class="row">
    <div class="col-xs-12 col-lg-8 col-lg-offset-2">
      <div class="panel panel-primary">
        <% if current_user.notifications_all_important == 0 %>
            <div class="panel-body">
          <span style="font-size: 1.5em;">
          Vous n'avez aucune nouvelle notifications
          </span>
            </div>
        <% else %>
            <div class="panel-body">
          <span style="font-size: 2.5em;">
          Notifications
          </span>
            </div>
            <% if @summary_wins.any? || @wins.any? %>
                <hr style="margin: 0 3em 2em 3em ">
                &nbsp <span class="green" style="font-size: 2em;"><span class="glyphicon glyphicon-arrow-up"></span> Vos contributions qui ont pris la première place</span>
            <% end %>
            <% if @summary_wins.any? %>
                <table class="table table-striped table-hover">
                  <thead>
                  <tr>
                    <th class="col-xs-1 center"></th>
                    <th class="col-xs-7">Votre</th>
                    <th class="col-xs-4">De la controverse</th>
                  </tr>
                  </thead>
                  <tbody class="page">
                  <% @summary_wins.each do |com| %>
                      <tr>
                        <td><span class="icon-5 green center" style="font-size: 2em;"></span></td>
                        <td>
                          <%= link_to "synthèse", notifications_summary_selection_win_path(id: com.id), class: "btn btn-primary" %>
                        </td>
                        <td>
                          <%= link_to com.timeline_name, timeline_path(com.timeline_id), class: "btn btn-primary" %>
                        </td>
                      </tr>
                  <% end %>
                  </tbody>
                </table>
            <% end %>
            <% if @wins.any? %>
                <table class="table table-striped table-hover">
                  <thead>
                  <tr>
                    <th class="col-xs-1 center"></th>
                    <th class="col-xs-3">Votre</th>
                    <th class="col-xs-4">De la référence</th>
                    <th class="col-xs-4">Dans la controverse</th>
                  </tr>
                  </thead>
                  <tbody class="page">
                  <% @wins.each do |notif| %>
                      <tr>
                        <td><span class="icon-5 green center" style="font-size: 2em;"></span></td>
                        <td>
                          <%= link_to notif.reference.article ? article_hash[notif.field] : review_hash[notif.field],
                                      notifications_selection_win_path(id:    notif.comment_id,
                                                                       field: notif.field), class: "btn btn-primary" %>
                        </td>
                        <td><%= link_to notif.reference.title, reference_path(notif.reference.id), class: "btn btn-primary" %>
                        </td>
                        <td>
                          <%= link_to notif.timeline.name, timeline_path(notif.timeline.id), class: "btn btn-primary" %>
                        </td>
                      </tr>
                  <% end %>
                  </tbody>
                </table>
            <% end %>
            <% if @summary_losses.any? || @losses.any? %>
                <hr style="margin: 0 3em 2em 3em ">
                &nbsp <span class="red" style="font-size: 2em;"><span class="glyphicon glyphicon-arrow-down"></span> Vos contributions qui ont perdu la première place</span>
            <% end %>
            <% if @summary_losses.any? %>

                <table class="table table-striped table-hover">
                  <thead>
                  <tr>
                    <th class="col-xs-1 center"></th>
                    <th class="col-xs-7">Votre</th>
                    <th class="col-xs-4">De la controverse</th>
                  </tr>
                  </thead>
                  <tbody class="page">
                  <% @summary_losses.each do |com| %>
                      <tr>
                        <td><span class="icon-1 red" style="font-size: 2em;"></span></td>
                        <td>
                          <%= link_to "synthèse", notifications_summary_selection_loss_path(id: com.id), class: "btn btn-primary" %>
                        </td>
                        <td>
                          <%= link_to com.timeline_name, timeline_path(com.timeline_id), class: "btn btn-primary" %>
                        </td>
                        <td><%= link_to "<span class=\"glyphicon glyphicon-trash\" aria-hidden=\"true\"></span>".html_safe,
                                        notifications_summary_selection_loss_path(id: com.id), class: "btn btn-danger" %></td>
                      </tr>
                  <% end %>
                  </tbody>
                </table>
            <% end %>
            <% if @losses.any? %>
                <table class="table table-striped table-hover">
                  <thead>
                  <tr>
                    <th class="col-xs-1 center"></th>
                    <th class="col-xs-3">Votre</th>
                    <th class="col-xs-4">De la référence</th>
                    <th class="col-xs-4">Dans la controverse</th>
                  </tr>
                  </thead>
                  <tbody class="page">
                  <% @losses.each do |notif| %>
                      <tr>
                        <td><span class="icon-1 red center" style="font-size: 2em;"></span></td>
                        <td>
                          <%= link_to notif.reference.article ? article_hash[notif.field] : review_hash[notif.field],
                                      notifications_selection_loss_path(id:    notif.comment_id,
                                                                        field: notif.field), class: "btn btn-primary" %>
                        </td>
                        <td>
                          <%= link_to notif.reference.title, reference_path(notif.reference.id), class: "btn btn-primary" %>
                        </td>
                        <td>
                          <%= link_to notif.timeline.name, timeline_path(notif.timeline.id), class: "btn btn-primary" %>

                        </td>
                      </tr>
                  <% end %>
                  </tbody>
                </table>
            <% end %>
            <% if @suggestions.any? %>
                <hr style="margin: 0 3em 2em 3em ">
                &nbsp <span class="blue" style="font-size: 2em;"><span class="glyphicon glyphicon-comment"></span> Les réponses à vos commentaires</span>
                <table class="table table-striped table-hover">
                  <thead>
                  <tr>
                    <th class="col-xs-1 center"></th>
                    <th class="col-xs-5">Votre commentaire</th>
                    <th class="col-xs-4">La réponse</th>
                    <th class="col-xs-2">Par</th>
                  </tr>
                  </thead>
                  <tbody class="page">
                  <% @suggestions.each do |notif| %>
                      <tr>
                        <td><span class="icon-4 blue center" style="font-size: 2em;"></span></td>
                        <td> <%= link_to truncate(notif.suggestion.comment, length: 140, separator: ' '),
                                         notifications_suggestion_path(id: notif.suggestion_child_id) %> </td>
                        <td> <%= link_to truncate(notif.suggestion_child.comment, length: 140, separator: ' '),
                                         notifications_suggestion_path(id: notif.suggestion_child_id) %> </td>
                        <td> <%= link_to "#{notif.suggestion_child.user_name}",
                                         user_path(id: notif.suggestion_child.user_id), class: "btn btn-primary" %> </td>
                      </tr>
                  <% end %>
                  </tbody>
                </table>
            <% end %>
            <div class="panel-body">
              <div class="pull-right">
                <%= link_to "<span class=\"glyphicon glyphicon-trash\" aria-hidden=\"true\"></span>&nbsp Supprimer ces notifications".html_safe,
                            notifications_delete_all_important_path,
                            class: 'btn btn-danger btn-lg',
                            data:  {disable_with: "<span class=\"glyphicon glyphicon-save\" aria-hidden=\"true\"></span> &nbsp Suppression en cours "} %>
              </div>
            </div>
        <% end %>
      </div>
    </div>
  </div>
</div>