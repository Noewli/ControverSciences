<% provide(:title, "Mes contributions") %>
<div id="my-container" class="container-fluid">
<div class="col-md-10 col-md-offset-1">
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingOne">
      <h4 class="panel-title clearfix">
        <a data-toggle="collapse" href="#collapseOne" class="pull-right glyphicon <%= @timelines.any? ? "glyphicon-chevron-up" : "glyphicon-chevron-down" %>"></a>
        <a data-toggle="collapse" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
          Mes controverses (<%= @timelines.length %>)
        </a>
      </h4>
    </div>
    <div id="collapseOne" class="panel-collapse collapse <%= @timelines.any? ? "in" : nil %>" role="tabpanel" aria-labelledby="headingOne">
      <table id="notification-timelines" class="table table-striped table-hover">
      <thead>
      <tr>
        <th class="col-sm-8"> Controverse </th>
        <th class="col-sm-3"> Thèmes </th>
        <th class="col-xs-1 center"> Modifier </th>
        <th class="col-sm-1 center"> Supprimer </th>
      </tr>
      </thead>

      <tbody class="page">
      <% if !@timelines.any? %>
          <tr class="notification-timeline">
            <td> <%= link_to "Vous n'avez pas encore créé de controverse",
                             new_timeline_path %> </td>
            <td>  </td>
            <td>  </td>
            <td>  </td>
          </tr>
      <% else %>
          <% @timelines.each do |timeline| %>
              <tr class="notification-timeline">
                <td> <%= link_to timeline.name.html_safe, timeline_path(timeline.id) %> </td>
                <td>
                  <% timeline.get_tag_list.each do |name| %>
                      <span class="icon-<%= name %>"></span>
                  <% end %>
                </td>
                <td class="center"> <%= link_to "<span class=\"glyphicon glyphicon-edit\"> </span>".html_safe,
                                                edit_timeline_path( timeline.id ) %>  </td>
                <td class="center"> <%= link_to "<span class=\"glyphicon glyphicon-trash\"> </span>".html_safe,
                                                timeline_path( timeline.id ), method: :delete,
                                                data: { confirm: "Etes vous certain ?" } %>  </td>
              </tr>
          <% end %>
          <tr class="notification-timeline">
            <td> <%= link_to "<span class=\"glyphicon glyphicon-plus-sign\"> </span> Créer une nouvelle controverse".html_safe,
                             new_timeline_path %> </td>
            <td>  </td>
            <td>  </td>
            <td>  </td>
          </tr>
      <% end %>
      </tbody>
    </table>
  </div>
  </div>
</div>

<div class="col-md-10 col-md-offset-1">
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingOne">
      <h4 class="panel-title clearfix">
        <a data-toggle="collapse" href="#collapseZero" class="pull-right glyphicon <%= @frames.any? ? "glyphicon-chevron-up" : "glyphicon-chevron-down" %>"></a>
        <a data-toggle="collapse" href="#collapseZero" aria-expanded="true" aria-controls="collapseZero">
          Mes propositions d'amélioration de controverses (<%= @frames.length %>)
        </a>
      </h4>
    </div>
    <div id="collapseZero" class="panel-collapse collapse <%= @frames.any? ? "in" : nil %>" role="tabpanel" aria-labelledby="headingOne">
      <table id="notification-timelines" class="table table-striped table-hover">
        <thead>
        <tr>
          <th class="col-sm-8"> Controverse </th>
          <th class="col-sm-3"> Thèmes </th>
          <th class="col-xs-1 center"> Modifier </th>
          <th class="col-sm-1 center"> Supprimer </th>
        </tr>
        </thead>

        <tbody class="page">
        <% if !@frames.any? %>
            <tr class="notification-timeline">
              <td> Vous n'avez pas encore proposé d'amélioration de controverses </td>
              <td>  </td>
              <td>  </td>
              <td>  </td>
            </tr>
        <% else %>
            <% @frames.each do |frame| %>
                <tr class="notification-timeline">
                  <td> <%= link_to frame.name_markdown.html_safe, frame_path(frame.id) %> </td>
                  <td>
                    <% frame.get_tag_list.each do |name| %>
                        <span class="icon-<%= name %>"></span>
                    <% end %>
                  </td>
                  <td class="center"> <%= link_to "<span class=\"glyphicon glyphicon-edit\"> </span>".html_safe,
                                                  edit_frame_path( frame.id ) %>  </td>
                  <td class="center"> <%= link_to "<span class=\"glyphicon glyphicon-trash\"> </span>".html_safe,
                                                  frame_path( frame.id ), method: :delete,
                                                  data: { confirm: "Etes vous certain ?" } %>  </td>
                </tr>
            <% end %>
        <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="col-md-10 col-md-offset-1">
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingTwo">
      <h4 class="panel-title clearfix">
        <a data-toggle="collapse" href="#collapseTwo" class="pull-right glyphicon <%= @summaries.any? ? "glyphicon-chevron-up" : "glyphicon-chevron-down" %>"></a>
        <a class="collapsed" data-toggle="collapse" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
          Mes synthèses (<%= @summaries.length %>)
        </a>
      </h4>
    </div>
    <div id="collapseTwo" class="panel-collapse collapse <%= @summaries.any? ? "in" : nil %>" role="tabpanel" aria-labelledby="headingTwo">
      <table id="notification-summaries" class="table table-striped table-hover">
      <thead>
      <tr>
        <th class="col-xs-1 center"> Crédits </th>
        <th class="col-xs-5"> Synthèse </th>
        <th class="col-xs-5"> De la controverse </th>
        <th class="col-xs-1 center"> Public </th>
        <th class="col-xs-1 center"> Modifier </th>
        <th class="col-xs-1 center"> Supprimer </th>
      </tr>
      </thead>

      <tbody class="page">
      <% if !@summaries.any? %>
          <tr class="notification-summary">
            <td> </td>
            <td> Pas encore de synthèses ajoutées </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>
      <% else %>
          <% @summaries.each do |com| %>
              <tr class="notification-summary">
                <td class="center"> <%= com.balance %> </td>
                <td> <%= link_to "Voir la synthèse",
                                 summaries_path(timeline_id: com.timeline_id, filter: "mine" ),
                                 class: "btn btn-primary" %>   </td>
                <td> <%= link_to com.timeline_name.html_safe, timeline_path(com.timeline_id ) %>   </td>
                <td class="center"> <%= com.public ? "<span class=\"glyphicon glyphicon-ok\"> </span>".html_safe :
                                                "<span class=\"glyphicon glyphicon-remove\"> </span>".html_safe %>  </td>
                <td class="center"> <%= link_to "<span class=\"glyphicon glyphicon-edit\"> </span>".html_safe,
                                                edit_summary_path( com.id ) %>  </td>
                <td class="center"> <%= link_to "<span class=\"glyphicon glyphicon-trash\"> </span>".html_safe,
                                                summary_path( com.id ), method: :delete,
                                                data: { confirm: "Etes vous certain ?" } %>  </td>
              </tr>
          <% end %>
      <% end %>
      </tbody>
    </table>
  </div>
  </div>
</div>

<div class="col-md-10 col-md-offset-1">
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingThree">
      <h4 class="panel-title clearfix">
        <a data-toggle="collapse" href="#collapseFour" class="pull-right glyphicon <%= @references.any? ? "glyphicon-chevron-up" : "glyphicon-chevron-down" %>"></a>
        <a class="collapsed" data-toggle="collapse" href="#collapseFour" aria-expanded="false" aria-controls="collapseThree">
          Mes références (<%= @references.length %>)
        </a>
      </h4>
    </div>
    <div id="collapseFour" class="panel-collapse collapse <%= @references.any? ? "in" : nil %>" role="tabpanel" aria-labelledby="headingFour">
      <table id="notification-references" class="table table-striped table-hover">
      <thead>
      <tr>
        <th class="col-xs-6"> La référence </th>
        <th class="col-xs-4"> Dans la controverse </th>
        <th class="col-xs-2 center"> Modifier </th>
        <th class="col-xs-2 center"> Supprimer </th>
      </tr>
      </thead>

      <tbody class="page">
      <% if !@references.any? %>
          <tr class="notification-reference">
            <td> Pas encore de références ajoutées  </td>
            <td></td>
            <td></td>
            <td></td>
          </tr>
      <% else %>
          <% @references.each do |reference| %>
              <tr class="notification-reference">
                <td> <%= link_to reference.title, reference_path(reference.id) %>   </td>
                <td> <%= link_to reference.timeline_name.html_safe, timeline_path(reference.timeline_id ) %>   </td>
                <td class="center"> <%= link_to "<span class=\"glyphicon glyphicon-edit\"> </span>".html_safe,
                                                edit_reference_path( reference.id ) %>  </td>
                <td class="center"> <%= link_to "<span class=\"glyphicon glyphicon-trash\"> </span>".html_safe,
                                                reference_path( reference.id ), method: :delete,
                                                data: { confirm: "Etes vous certain ?" } %>  </td>
              </tr>
          <% end %>
      <% end %>
      </tbody>
    </table>
    </div>
  </div>
</div>

<div class="col-md-10 col-md-offset-1">
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingThree">
      <h4 class="panel-title clearfix">
        <a data-toggle="collapse" href="#collapseThree" class="pull-right glyphicon <%= @comments.any? ? "glyphicon-chevron-up" : "glyphicon-chevron-down" %>"></a>
        <a class="collapsed" data-toggle="collapse" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
          Mes analyses (<%= @comments.length %>)
        </a>
      </h4>
    </div>
    <div id="collapseThree" class="panel-collapse collapse <%= @comments.any? ? "in" : nil %>" role="tabpanel" aria-labelledby="headingThree">
      <table id="notification-comments" class="table table-striped table-hover">
      <thead>
      <tr>
        <th class="col-xs-1 center"> Crédits </th>
        <th class="col-xs-3"> L'analyse </th>
        <th class="col-xs-4"> De la référence </th>
        <th class="col-xs-3"> Dans la controverse </th>
        <th class="col-xs-1 center"> Public </th>
        <th class="col-xs-1 center"> Modifier </th>
        <th class="col-xs-1 center"> Supprimer </th>
      </tr>
      </thead>

      <tbody class="page">
      <% if !@comments.any? %>
          <tr class="notification-comment">
            <td> </td>
            <td> Pas encore d'analyses ajoutées </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>
      <% else %>
          <% @comments.each do |com| %>
              <tr class="notification-comment">
                <td class="center"> <%= com.balance %> </td>
                <td> <%= link_to "Voir l'analyse", reference_path(com.reference_id, filter: :mine ), class: "btn btn-primary" %>   </td>
                <td> <%= link_to com.reference_title, reference_path(com.reference_id) %>   </td>
                <td> <%= link_to com.timeline_name.html_safe, timeline_path(com.timeline_id ) %>   </td>
                <td class="center"> <%= com.public ? "<span class=\"glyphicon glyphicon-ok\"> </span>".html_safe :
                                                "<span class=\"glyphicon glyphicon-remove\"> </span>".html_safe %>  </td>
                <td class="center"> <%= link_to "<span class=\"glyphicon glyphicon-edit\"> </span>".html_safe,
                                                edit_comment_path( com.id ) %>  </td>
                <td class="center"> <%= link_to "<span class=\"glyphicon glyphicon-trash\"> </span>".html_safe,
                                                comment_path( com.id ), method: :delete,
                                                data: { confirm: "Etes vous certain ?" } %>  </td>
              </tr>
          <% end %>
      <% end %>
      </tbody>
    </table>
    </div>
  </div>
</div>

<div class="col-md-10 col-md-offset-1">
  <div class="panel panel-default">
    <div class="panel-heading" role="tab" id="headingThree">
      <h4 class="panel-title clearfix">
        <a data-toggle="collapse" href="#collapseSix" class="pull-right glyphicon <%= @suggestions.any? ? "glyphicon-chevron-up" : "glyphicon-chevron-down" %>"></a>
        <a class="collapsed" data-toggle="collapse" href="#collapseSix">
          Mes commentaires (<%= @suggestions.length + @suggestions_children.length %>)
        </a>
      </h4>
    </div>
    <div id="collapseSix" class="panel-collapse collapse <%= @comments.any? ? "in" : nil %>" role="tabpanel">
      <table id="notification-comments" class="table table-striped table-hover">
        <thead>
        <tr>
          <th class="col-xs-8 center"> Commentaire </th>
          <th class="col-xs-2 center"> Modifier </th>
          <th class="col-xs-2 center"> Supprimer </th>
        </tr>
        </thead>

        <tbody class="page">
        <% if not (@suggestions.any? || @suggestions_children.any?) %>
            <tr class="notification-comment">
              <td> <%= link_to "Aucun commentaire", suggestions_path %> </td>
              <td> </td>
              <td> </td>
            </tr>
        <% else %>
            <% @suggestions.each do |com| %>
                <tr class="notification-comment">
                  <td> <%= link_to truncate(com.comment, length: 140, separator: ' '), suggestion_path(com.id ) %>   </td>
                  <td class="center"> <%= link_to "<span class=\"glyphicon glyphicon-edit\"> </span>".html_safe,
                                                  edit_suggestion_path( com.id ) %>  </td>
                  <td class="center"> <%= link_to "<span class=\"glyphicon glyphicon-trash\"> </span>".html_safe,
                                                  suggestion_path( com.id ), method: :delete,
                                                  data: { confirm: "Etes vous certain ?" } %>  </td>
                </tr>
            <% end %>
            <% @suggestions_children.each do |com| %>
                <tr class="notification-comment">
                  <td> <%= link_to truncate(com.comment, length: 140, separator: ' '), suggestion_child_path(com.id ) %>   </td>
                  <td class="center"> <%= link_to "<span class=\"glyphicon glyphicon-edit\"> </span>".html_safe,
                                                  edit_suggestion_child_path( com.id ) %>  </td>
                  <td class="center"> <%= link_to "<span class=\"glyphicon glyphicon-trash\"> </span>".html_safe,
                                                  suggestion_child_path( com.id ), method: :delete,
                                                  data: { confirm: "Etes vous certain ?" } %>  </td>
                </tr>
            <% end %>
        <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
</div>

<script type="text/javascript">
    $('.collapse').on('show.bs.collapse', function () {
        $(this).parent(".panel").find(".glyphicon-chevron-down").removeClass("glyphicon-chevron-down").addClass("glyphicon-chevron-up");

    });
    $('.collapse').on('hide.bs.collapse', function () {
        $(this).parent("div").parent("div").find(".glyphicon-chevron-up").removeClass("glyphicon-chevron-up").addClass("glyphicon-chevron-down");
    });
</script>